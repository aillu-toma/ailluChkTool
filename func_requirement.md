## 要件

* 勤怠チェックを行う
* 複数csvの整合性チェック

## システム要件

* 以下を利用し、PCにインストール不要で利用できるものを作成する
    * Java script
    * HTML
    * CSS

## 利用CSV
* 日次データ.csv
* 届け出データ.csv

# 詳細設計

* チェックの種類
    * チェックが発生する状況
        * 勤務区分チェック
        * 残業
        * 在宅
        * 在宅残業
        * 定時外の勤務
            * 残業
            * 深夜
        * 打刻忘れ時のコメント有無

* マスタデータ
    * 日次データ.csv
* トランザクションデータ
    * 届け出データ

* マスタデータの項目
    * 社員コード
    * 社員氏名（漢字）
    * 年月日
    * 曜日コード
    * 勤務区分
    * 勤務区分名称（漢字）
    * 就業開始時刻
    * 就業終了時刻
    * 休暇コード
    * 休暇コード名称
    * 実働時間
    * フレックス対象時間差
    * コメント
    * 承認状況
* トランザクションデータの項目
    * 社員コード
    * 社員氏名（漢字）
    * 届出区分
    * 届出略称
    * 対象年月日
    * 休暇名称（漢字）
    * 深夜外残業時間
    * 深夜残業時間

# CSVファイルについて
CSVの文字コードはsjisとする
CSVの項目は上記以外にも存在し、項目が増減する場合もあるためロジック内では「項目名の文字列が一致する項目」で利用項目を判定する
配列の位置では項目を判定してはいけない

2つのcsvの照合キー項目は以下とする
* マスタファイル
    * 社員コード
    * 年月日
* トランザクションデータ
    * 社員コード
    * 対象年月日

### チェック０　担当：川島 + 藤間
在宅か出社かチェック
マスタデータの項目：勤務区分を確認
前提として、勤務区分 = 空白の場合は処理スキップしチェックを行わない

    勤務区分 = EFS01の場合、
	    チェック１を行う
 
    勤務区分 = Z01の場合、
	    トランザクションデータの項目：届出区分を確認
	    届出区分 = 85　の場合、チェック2を行う
    
    上記以外    
		エラーを出力    

### チェック１　担当：藤間
残業申請有無チェック

チェック内容
    社員コード毎に下記チェックを行う
チェック詳細
    在宅勤務の場合(勤務区分がZから始まるもの)、処理をスキップしチェックを行わない

    マスタデータの項目：
    勤務区分がEFS01かつ、
    実働時間>8の場合の日付を取得
    日付はマスタデータの項目：年月日で確認する

    トランザクションデータに下記データが存在することを確認
    マスタデータの項目：社員コードと年月日が一致するレコードを検索
    合致したレコードのトランザクションデータ項目：届出区分=80が存在することを確認する
### チェック1_1
残業時間チェック
チェック内容
    チェック１をクリアした場合、トランザクションデータの
    社員コード毎に実勤務時間と残業申請時間のチェックを行う
チェック詳細
    チェック１で届け出区分=80となった対象に対して、下記チェックを行う
    マスタデータの項目：実働時間から8時間を差し引いた時間を残業時間とする
        小数点以下の値は1分単位。8.31の場合は実働時間8時間31分となる。
        この場合、8.31から8時間を差し引いた0.31=31分が残業時間となる。
    トランザクションデータの項目：深夜外残業時間と深夜残業時間の合計値を計算する
        深夜外残業時間=0.3、深夜残業時間=0.15　の場合、45分が残業時間となる。
    

### チェック2　担当：杉浦
在宅残業申請チェック

チェック内容
    社員コード毎に下記チェックを行う
チェック詳細
    マスタデータの項目：
    勤務区分がZ01かつ、
    実働時間>8の場合の日付を取得
    日付はマスタデータの項目：年月日で確認する

    トランザクションデータに下記データが存在することを確認
    マスタデータの項目：社員コードと年月日が
    トランザクションデータの項目：社員コードと対象年月日が一致するレコードを検索
    合致したレコードのトランザクションデータ項目：届出区分=81が存在することを確認する
### チェック2_1
    在宅残業時間チェック
チェック内容
    チェック2をクリアした場合、トランザクションデータの
    社員コード毎に実勤務時間と在宅残業申請時間のチェックを行う
チェック詳細
    チェック2で届出区分=81となった対象に対して、下記チェックを行う
    マスタデータの項目：実働時間から8時間を差し引いた時間を在宅残業時間とする
        例）実働時間=8.15の場合、8時間15分と考える
            8時間15分から8時間を差し引いた15分が、在宅残業時間とする
    トランザクションデータの項目：深夜外残業時間と深夜残業時間の合計値を計算する
        例）深夜外残業時間=0.3、深夜残業時間=0.15　の場合、45分が残業時間となる。



### チェック3　担当：石江　+　渡邉
定時外の勤務（22時～5時の残業が対象）
前提（チェック1で対応済みの項目）	
    マスタデータの項目：実働時間>8の場合　かつ、
    マスタデータの項目：就業終了時刻=22:00 ~ 翌朝5:00の間　かつ、
    残業申請有無チェックでエラーになっていない場合がチェック対象
    小数点以下の値は1分単位。8.31の場合は実働時間8時間31分となる。

チェック詳細
    チェック3-1
	
        ①マスタデータの項目：実働時間 - 8 を残業時間として算出

        ②トランザクションデータ項目：「深夜外残業時間」+「深夜残業時間」を届け出残業時間として算出

        ① = ② となっていない場合、エラーを出力する

    チェック3-2

        マスタデータの項目：就業終了時刻 > 22:00　の時間を取得
        就業終了時刻=23:21の場合、取得時間は1:21となる(81分)     
        トランザクションデータの項目：「深夜残業時間」が上記取得時間と一致することを確認する

### チェック4　担当：北村 + 渡邉
チェック０をパスしている前提
前提として、マスタデータの項目：勤務区分 = 空白 または、
マスタデータの項目：承認状況 = 空白　または
マスタデータの項目：休暇コード != 空白の場合は処理スキップしチェックを行わない

チェック内容
    打刻時間開始または打刻時間終了が0の場合に以下の項目についてチェックを行う
    * コメント欄に値がセットされていること

---

## 【2025年7月修正版】実装詳細設計・仕様（script.js反映済み）

### 共通仕様
- CSVはShift-JIS、項目名で列を特定し、配列位置で判定しない。
- 日次データ（マスタ）・届け出データ（トランザクション）を照合キー（社員コード＋日付）で突合。
- 時間計算は「8.45→8時間45分」「0.45→45分」など60進数換算を徹底。
- 深夜外残業時間・深夜残業時間も0.45なら45分として扱う。

### チェック0: 勤務区分チェック
- 勤務区分が空白ならスキップ。
- 勤務区分=EFS01→チェック1へ。
- 勤務区分=Z01→届け出区分=85があればチェック2へ。なければエラー。
- 上記以外はエラー。

### チェック1: 残業申請有無
- 勤務区分がEFS01かつ実働時間>8のみ対象。
- 届け出データに「社員コード＋日付＋届け出区分=80」がなければエラー。
- 勤務区分がZで始まる場合はスキップ。

### チェック1_1: 残業時間チェック
- チェック1で届け出区分=80がある場合のみ。
- 実働時間-8時間を「60進数」で分換算（例: 8.45→45分）。
- 届け出データの深夜外残業時間＋深夜残業時間（どちらも60進数で分換算）の合計と比較。
- 1分単位の誤差のみ許容。
- エラー出力は分単位で明示。

### チェック2: 在宅残業申請有無
- 勤務区分がZ01かつ実働時間>8のみ対象。
- 届け出データに「社員コード＋日付＋届け出区分=81」がなければエラー。

### チェック2_1: 在宅残業時間チェック
- チェック2で届け出区分=81がある場合のみ。
- 実働時間-8時間を「60進数」で分換算。
- 届け出データの深夜外残業時間＋深夜残業時間（どちらも60進数で分換算）の合計と比較。
- 1分単位の誤差のみ許容。
- エラー出力は分単位で明示。

### チェック3: 定時外の勤務（22:00～翌5:00）
- 実働時間>8かつ残業申請有無エラーでないもののみ対象。
- 勤務区分EFS01は届け出区分=80、Z01は届け出区分=81のみを対象。
- 残業時間合計チェック：
    - 実働時間-8（60進数で分換算）と、届け出データの深夜外残業時間＋深夜残業時間（60進数で分換算）の合計を比較。
    - 1分単位の誤差のみ許容。
    - エラー出力は分単位で明示。
- 深夜残業時間チェック：
    - 退勤時刻が22:00～翌5:00の場合、その分数と届け出データの深夜残業時間（60進数で分換算）を比較。
    - 1分単位の誤差のみ許容。

### チェック4: 打刻忘れコメント有無
- 勤務区分・承認状況が空白、または休暇コードが空白でない場合はスキップ。
- 打刻開始または終了が0の場合のみコメント必須。
- コメントがなければエラー。

---

【備考】
- すべてのチェックで「分」単位の比較・出力を徹底。
- 勤務区分ごとに対応する届け出区分のみを厳密に参照。
- 仕様変更・バグ修正履歴はscript.jsのコメントまたはGitHub履歴参照。